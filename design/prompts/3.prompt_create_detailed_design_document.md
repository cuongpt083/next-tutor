# Create Detailed Design Document

Bạn là một Kiến trúc sư Phần mềm có kinh nghiệm. Dựa trên tài liệu SRS đính kèm về dự án 'Next Generation Private Tutor', hãy tạo một tài liệu thiết kế chi tiết (Detailed Design Document) hoàn chỉnh.

Mục tiêu của tài liệu này: Cung cấp một bản kế hoạch kỹ thuật hoàn chỉnh, đủ chi tiết để chuyển đổi trực tiếp thành mã nguồn thực thi được (VIBE Coding), đáp ứng tất cả các Yêu cầu Chức năng (FR) và Yêu cầu Phi chức năng (NFR) đã nêu trong SRS. Nó phải là cầu nối giữa 'cái gì' (SRS) và 'làm thế nào' (mã nguồn).

Đối tượng đọc: Tài liệu này sẽ được sử dụng làm blueprint trực tiếp cho việc sinh mã nguồn bằng LLM (VIBE Coding) và để một Kiến trúc sư Phần mềm con người xem xét. Do đó, tài liệu phải cực kỳ chi tiết, không có bất kỳ giả định hay sự mơ hồ nào. Mọi giao diện, luồng dữ liệu, và logic nghiệp vụ phải được định nghĩa tường minh.

Phong cách & Định dạng: Sử dụng định dạng Markdown. Văn phong kỹ thuật, chính xác, không mơ hồ. Trình bày dưới dạng các phần có cấu trúc rõ ràng, bao gồm: mô tả kiến trúc tổng thể (sử dụng Mermaid), đặc tả API (REST endpoints, request/response JSON schema), mô tả các thành phần Frontend (component hierarchy), thiết kế cơ sở dữ liệu (ERD và DDL), và chiến lược tích hợp AI. Sử dụng pseudo-code hoặc mô tả thuật toán chi tiết khi cần.

Ràng buộc & Công nghệ: Thiết kế phải tuân thủ nghiêm ngặt các ràng buộc công nghệ đã nêu trong SRS (Mục 6.1): Backend (Spring Boot/Python), Frontend (Angular/React/Vue), Database (PostgreSQL). Đặc biệt chú ý đến mẫu thiết kế BFF (Backend For Frontend) và cơ chế xoay vòng API Key (Rotation API Key) cho AI Service (NFR-03, NFR-07). Đảm bảo thiết kế đáp ứng các NFR về hiệu năng (NFR-01, NFR-02), bảo mật (NFR-03, NFR-04) và khả năng sử dụng (NFR-05, NFR-06).

Phạm vi: Thiết kế phải tập trung hoàn toàn vào phạm vi MVP như đã định nghĩa trong SRS (Mục 1.2). Mặc dù cần có khả năng mở rộng cho các tính năng tương lai, nhưng không được phép over-engineer cho giai đoạn MVP này.

Đặc điểm người dùng: Thiết kế giao diện người dùng (Frontend) phải cụ thể hóa các yêu cầu 'Kid-friendly' từ SRS (Mục 5.1, 5.2, 5.3) thành các thành phần UI/UX chi tiết (ví dụ: kích thước nút, vị trí micro, animation phản hồi). Thiết kế cơ sở dữ liệu và API phải hỗ trợ đầy đủ việc theo dõi tiến độ học tập cho cả Học viên và Phụ huynh.

Cấu trúc tài liệu thiết kế chi tiết: Tài liệu phải bao gồm các phần sau, ánh xạ trực tiếp với các FR và NFR trong SRS, và sử dụng các ví dụ định dạng được cung cấp:

1. Kiến trúc tổng thể: Sơ đồ kiến trúc hệ thống (Mermaid Component Diagram) mô tả Frontend, BFF, AI Services, Database.
2. Thiết kế API Backend:
Liệt kê các REST API endpoints cho từng FR (ví dụ: POST /auth/login/facebook, GET /tutors, POST /learning/speaking).
Đặc tả chi tiết request/response JSON schema cho mỗi endpoint.
Mô tả logic xử lý chính của từng API, bao gồm tương tác với AI Service và Database.

Ví dụ định dạng API:

```json
// POST /api/v1/learning/speaking/start
// Mô tả: Khởi tạo một phiên luyện nói mới với AI Tutor.
// Request:
{
  "tutorId": "string", // ID của gia sư AI đã chọn
  "topicId": "string"  // ID của chủ đề luyện tập
}
// Response (200 OK):
{
  "sessionId": "string", // ID của phiên học mới
  "initialPrompt": "string" // Câu chào hoặc câu hỏi mở đầu từ AI
}
// Response (400 Bad Request):
{
  "errorCode": "string",
  "message": "string"
}
```

3. Thiết kế Cơ sở dữ liệu:
ERD (Mermaid Entity-Relationship Diagram) mô tả các bảng chính (User, Tutor, LearningSession, Progress, etc.).
DDL (Data Definition Language) cho mỗi bảng, bao gồm các trường, kiểu dữ liệu, khóa chính/phụ, ràng buộc.

Ví dụ định dạng DB DDL:

```sql
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    oauth_provider VARCHAR(50) NOT NULL,
    oauth_id VARCHAR(255) UNIQUE NOT NULL,
    display_name VARCHAR(255),
    avatar_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

4. Thiết kế Frontend Components:
Mô tả cấu trúc thư mục và các thành phần UI chính (ví dụ: LoginComponent, TutorSelectionComponent, ChatComponent, DashboardComponent).
Mô tả cách các component tương tác với API Backend.
Cụ thể hóa các yêu cầu UI/UX từ SRS (Mục 5) thành các thuộc tính của component.
5. Chiến lược Tích hợp AI:
Mô tả chi tiết cách BFF quản lý API Key, chọn AI Service (rotation), truyền ngữ cảnh hội thoại (context) và xử lý phản hồi từ AI (TTS/STT).
6. Xử lý lỗi và Bảo mật:
Chiến lược xử lý lỗi (ví dụ: mã lỗi HTTP, thông báo lỗi).
Cơ chế xác thực (OAuth2) và ủy quyền (Authorization).
Cách bảo vệ API Key và dữ liệu người dùng.
Bối cảnh: Thiết kế phải đặc biệt chú trọng đến các yếu tố Gamification (FR-06) và tương tác Voice-first (FR-03) đã nêu trong SRS. Đảm bảo các luồng thiết kế hỗ trợ việc quản lý ngữ cảnh hội thoại cho AI để duy trì trải nghiệm học tập liên tục và cá nhân hóa."
